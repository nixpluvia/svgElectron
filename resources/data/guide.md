# 보안 API 관련 내용 (JWT)

## 개요

리액트(CSR)에서 API로 권한에 관련된 통신을 수행하려면 JWT를 사용해서 인증 받는 방식이 좋다.

해당 통신을 위해서 서버와 클라이언트 측에서 해야 하는 일에 대해서 간단하게 참고 사이트와 내용을 정리하도록 한다.

## JWT의 구성

아래와 같이 간단하게 구성에대해서 설명한다.

JWT의 구성은 헤더, 페이로드, 서명의 조합으로 구성되어 있다.
JWT를 사용한 통신은 Base64로 변환된 데이터로  구성되어있으며 해당 데이터를 변환하면 JSON 데이터를 확인할 수 있게 된다.

여기서 서명 부가 가장 중요한데 서버에서는 헤더와 페이로드를 base64로 변환한 뒤 해당 내용(헤더, 페이로드)과 서버가 가지고 있는 비밀 키를 암호화방식(SHA256 등)을 사용해서 서명 부를 생성한다.

결과적으로 클라이언트가 수신한 JWT는 base64로 간단히 변환되어서 사용 가능하지만 포함된 서명 부는 서버의 비밀 키를 알지 못하는 이상 확인할 수 없게 된다.

## XSS 취약점

해당 JWT로 인증(로그인)을 받은 후 해당 데이터를 localStorage, sessionStorage 등의 클라이언트에서 접근 가능한 데이터로 보관을 할 경우 XSS공격에 의해서 해당 JWT가 노출 될 경우 해당 JWT인증의 만료 기간 전에 탈취 당했을 경우 해당 JWT를 사용해서 인증된 사용자인 것처럼 API 요청을 보낼 수 있게 된다.

### HttpOnly 쿠키

XSS 취약점으로부터 자유롭기 위해서 클라이언트의 스크립트로 접근 불가능한 HttpOnly 쿠키를 사용해서 액세스 토큰을 JWT로 받는다면 API 통신 시에 자동으로 해당 쿠키를 API 요청에 포함합니다.
다만, CSRF 공격에는 취약해질 수 있음으로 SameSite 설정 등의 보안이 필요합니다.

## 참고사이트

- https://velog.io/@seung7152/Spring-security-JWT%ED%86%A0%ED%81%B0
- https://velog.io/@vamos_eon/JWT%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94%EA%B0%80-1
- https://mangkyu.tistory.com/56